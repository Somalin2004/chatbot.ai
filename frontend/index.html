<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>CHATBOT.AI</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="description" content="Advanced AI chatbot with comprehensive response capabilities" />
<style>
/* Reset and base styles */
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',system-ui,sans-serif;
  background:#0f0f0f;color:#ffffff;min-height:100vh;overflow-x:hidden;
  line-height:1.6;
}

/* Container */
.container{
  max-width:900px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column;
  background:linear-gradient(135deg,rgba(15,15,15,0.95),rgba(25,25,25,0.95));
  border-left:1px solid rgba(255,255,255,0.05);
  border-right:1px solid rgba(255,255,255,0.05);
}

/* Header */
.header{
  padding:20px 24px;
  border-bottom:1px solid rgba(255,255,255,0.08);
  display:flex;align-items:center;justify-content:space-between;
  backdrop-filter:blur(20px);
  background:linear-gradient(135deg,rgba(32,178,170,0.12),rgba(30,144,255,0.12));
  position:sticky;top:0;z-index:100;
  box-shadow:0 4px 20px rgba(0,0,0,0.3);
  border-radius:0 0 16px 16px;
}

.logo{
  display:flex;align-items:center;gap:12px;font-weight:700;font-size:18px;
  background:linear-gradient(135deg,#20b2aa,#1e90ff);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  background-clip:text;
}

.logo-icon{
  width:32px;height:32px;
  background:linear-gradient(135deg,#20b2aa,#1e90ff);
  border-radius:8px;display:flex;align-items:center;justify-content:center;
  font-size:16px;color:#fff;font-weight:bold;
  box-shadow:0 4px 12px rgba(32,178,170,0.3);
}

.header-actions{display:flex;align-items:center;gap:12px}

.new-thread-btn{
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.15);
  color:#fff;padding:10px 16px;border-radius:10px;font-size:14px;cursor:pointer;
  transition:all 0.3s ease;font-weight:500;
  backdrop-filter:blur(10px);
}

.new-thread-btn:hover{
  background:rgba(255,255,255,0.12);
  border-color:rgba(32,178,170,0.5);
  transform:translateY(-1px);
  box-shadow:0 4px 12px rgba(32,178,170,0.2);
}

/* Chat area */
#chat{
  flex:1;overflow-y:auto;scroll-behavior:smooth;
  padding:0 8px;
}

#chat::-webkit-scrollbar{width:6px;}
#chat::-webkit-scrollbar-track{background:transparent;}
#chat::-webkit-scrollbar-thumb{
  background:rgba(255,255,255,0.2);border-radius:3px;
}
#chat::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,0.3);}

/* Messages */
.msg{
  padding:32px 24px;
  border-bottom:1px solid rgba(255,255,255,0.04);
  animation:fadeUp 0.4s cubic-bezier(0.4,0,0.2,1);
  margin:0 8px;border-radius:12px;
  transition:background-color 0.2s ease;
}

.msg:hover{background:rgba(255,255,255,0.02);}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(12px);}
  to{opacity:1;transform:translateY(0);}
}

.msg-header{
  display:flex;align-items:center;gap:12px;margin-bottom:16px;
}

.msg-avatar{
  width:28px;height:28px;border-radius:8px;
  display:flex;align-items:center;justify-content:center;
  font-size:14px;font-weight:700;flex-shrink:0;
}

.user-avatar{
  background:linear-gradient(135deg,#1a73e8,#4285f4);
  color:white;box-shadow:0 2px 8px rgba(26,115,232,0.3);
}

.bot-avatar{
  background:linear-gradient(135deg,#20b2aa,#1e90ff);
  color:white;box-shadow:0 2px 8px rgba(32,178,170,0.3);
}

.msg-role{
  font-size:15px;font-weight:600;color:#e8e8e8;
}

.msg-timestamp{
  font-size:12px;color:#808080;margin-left:auto;
}

/* Enhanced message content */
.msg-content{
  font-size:15px;line-height:1.7;color:#ffffff;
  padding-left:40px;overflow-x:auto;
  word-wrap:break-word;max-width:100%;
}

/* Enhanced markdown styling */
.msg-content h1{
  font-size:24px;font-weight:700;margin:24px 0 16px 0;
  color:#20b2aa;border-bottom:2px solid rgba(32,178,170,0.3);
  padding-bottom:8px;
}

.msg-content h2{
  font-size:20px;font-weight:600;margin:20px 0 12px 0;
  color:#1e90ff;
}

.msg-content h3{
  font-size:16px;font-weight:600;margin:16px 0 8px 0;
  color:#ffa500;
}

.msg-content p{margin:12px 0;line-height:1.7;}

.msg-content ul,.msg-content ol{
  margin:12px 0 12px 20px;
}

.msg-content li{
  margin:6px 0;line-height:1.6;
}

.msg-content blockquote{
  border-left:4px solid #20b2aa;
  margin:16px 0;padding:12px 16px;
  background:rgba(32,178,170,0.1);
  border-radius:0 8px 8px 0;
}

.msg-content pre{
  background:#1a1a1a;border:1px solid rgba(255,255,255,0.1);
  padding:16px;border-radius:8px;overflow-x:auto;margin:16px 0;
  font-family:'SF Mono',Monaco,'Cascadia Code','Roboto Mono',monospace;
  font-size:14px;line-height:1.5;
}

.msg-content code{
  background:rgba(255,255,255,0.1);
  padding:3px 6px;border-radius:4px;
  font-family:'SF Mono',Monaco,'Cascadia Code','Roboto Mono',monospace;
  font-size:13px;color:#ffa500;
}

.msg-content pre code{
  background:transparent;padding:0;color:#e8e8e8;
}

.msg-content table{
  width:100%;border-collapse:collapse;margin:16px 0;
  background:rgba(255,255,255,0.02);border-radius:8px;overflow:hidden;
}

.msg-content th,.msg-content td{
  padding:12px 16px;text-align:left;
  border-bottom:1px solid rgba(255,255,255,0.1);
}

.msg-content th{
  background:rgba(32,178,170,0.2);color:#20b2aa;font-weight:600;
}

.msg-content strong{color:#20b2aa;font-weight:600;}
.msg-content em{color:#1e90ff;font-style:italic;}

/* Input area */
.input-wrapper{
  padding:24px;background:#0f0f0f;
  border-top:1px solid rgba(255,255,255,0.08);
  position:sticky;bottom:0;
  backdrop-filter:blur(20px);
}

.input-container{
  position:relative;
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.12);
  border-radius:16px;transition:all 0.3s ease;
  backdrop-filter:blur(10px);
}

.input-container:focus-within{
  border-color:#20b2aa;
  box-shadow:0 0 0 1px rgba(32,178,170,0.5),0 8px 24px rgba(32,178,170,0.15);
  background:rgba(255,255,255,0.1);
}

.input-box{display:flex;align-items:flex-end;gap:12px;padding:16px 20px;}

#input{
  flex:1;background:transparent;border:none;outline:none;color:#fff;
  font-size:15px;line-height:1.6;resize:none;min-height:24px;max-height:120px;
  font-family:inherit;
}

#input::placeholder{color:#999;opacity:1;}

.input-actions{display:flex;align-items:center;gap:8px;}

#send{
  background:transparent;border:none;color:#808080;cursor:pointer;
  padding:8px;border-radius:8px;display:flex;align-items:center;
  justify-content:center;transition:all 0.3s ease;width:40px;height:40px;
}

#send:hover:not(:disabled){
  color:#20b2aa;background:rgba(32,178,170,0.15);
  transform:scale(1.05);
}

#send:disabled{opacity:.4;cursor:not-allowed;}

#send.sending{
  animation:pulse 1.5s infinite;
}

@keyframes pulse{
  0%,100%{opacity:0.6;}
  50%{opacity:1;}
}

/* Empty state */
.empty-state{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  min-height:70vh;text-align:center;padding:48px 24px;
}

.empty-logo{
  width:80px;height:80px;
  background:linear-gradient(135deg,#20b2aa,#1e90ff);
  border-radius:20px;display:flex;align-items:center;justify-content:center;
  font-size:32px;margin-bottom:32px;
  box-shadow:0 8px 32px rgba(32,178,170,0.3);
  animation:float 3s ease-in-out infinite;
}

@keyframes float{
  0%,100%{transform:translateY(0px);}
  50%{transform:translateY(-8px);}
}

.empty-title{
  font-size:36px;font-weight:700;margin-bottom:12px;
  background:linear-gradient(135deg,#ffffff,#e0e0e0);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  background-clip:text;
}

.empty-subtitle{
  font-size:18px;color:#999;margin-bottom:48px;max-width:500px;
}

.suggestions-grid{
  display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
  gap:16px;width:100%;max-width:700px;
}

/* Enhanced suggestion cards */
.suggestion-card{
  backdrop-filter:blur(20px);
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:16px;padding:20px;cursor:pointer;
  transition:all 0.3s ease;
  display:flex;align-items:flex-start;gap:16px;
  position:relative;overflow:hidden;
}

.suggestion-card::before{
  content:'';position:absolute;top:0;left:0;right:0;bottom:0;
  background:linear-gradient(135deg,rgba(32,178,170,0.05),rgba(30,144,255,0.05));
  opacity:0;transition:opacity 0.3s ease;
}

.suggestion-card:hover{
  background:rgba(255,255,255,0.1);
  border-color:rgba(32,178,170,0.3);
  transform:translateY(-4px) scale(1.02);
  box-shadow:0 12px 32px rgba(32,178,170,0.2);
}

.suggestion-card:hover::before{opacity:1;}

.suggestion-icon{
  font-size:24px;flex-shrink:0;margin-top:4px;
  filter:drop-shadow(0 2px 4px rgba(0,0,0,0.3));
}

.suggestion-content{flex:1;}

.suggestion-title{
  font-weight:600;font-size:16px;color:#fff;margin-bottom:8px;
  position:relative;z-index:1;
}

.suggestion-desc{
  font-size:14px;color:#bbb;line-height:1.5;
  position:relative;z-index:1;
}

/* Enhanced typing indicator */
.typing-indicator{
  display:none;padding:32px 24px;
  border-bottom:1px solid rgba(255,255,255,0.04);
  margin:0 8px;border-radius:12px;
  background:rgba(32,178,170,0.03);
}

.typing-content{
  padding-left:40px;display:flex;align-items:center;gap:12px;
  color:#999;font-size:15px;
}

.typing-dots{display:flex;gap:4px;}

.typing-dot{
  width:8px;height:8px;background:#20b2aa;border-radius:50%;
  animation:typingBounce 1.4s infinite ease-in-out;
}

.typing-dot:nth-child(1){animation-delay:-0.32s;}
.typing-dot:nth-child(2){animation-delay:-0.16s;}

@keyframes typingBounce{
  0%,80%,100%{opacity:0.3;transform:scale(0.8);}
  40%{opacity:1;transform:scale(1.2);}
}

/* Message counter */
.message-counter{
  position:absolute;top:20px;right:24px;
  background:rgba(32,178,170,0.1);border:1px solid rgba(32,178,170,0.3);
  color:#20b2aa;padding:6px 12px;border-radius:20px;
  font-size:12px;font-weight:500;
}

/* Responsive design */
@media(max-width:768px){
  .container{max-width:100%;border-left:none;border-right:none;}
  .header{padding:16px 20px;border-radius:0;}
  .suggestions-grid{grid-template-columns:1fr;}
  .suggestion-card{padding:16px;}
  .empty-title{font-size:28px;}
  .empty-subtitle{font-size:16px;}
  .msg{padding:24px 20px;margin:0;}
  .msg-content{padding-left:24px;font-size:14px;}
  .input-box{padding:12px 14px;}
}

/* Loading states */
.loading{opacity:0.7;pointer-events:none;}

/* Error states */
.error-msg{
  background:rgba(255,69,58,0.1);
  border:1px solid rgba(255,69,58,0.3);
  color:#ff453a;
  padding:12px 16px;
  border-radius:8px;
  margin:16px 0;
  display:flex;
  align-items:center;
  gap:8px;
}

/* Success states */
.success-msg{
  background:rgba(52,199,89,0.1);
  border:1px solid rgba(52,199,89,0.3);
  color:#32d74b;
  padding:12px 16px;
  border-radius:8px;
  margin:16px 0;
  display:flex;
  align-items:center;
  gap:8px;
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo">
      <div class="logo-icon">⚡</div>
      <span>CHATBOT.AI</span>
    </div>
    <div class="header-actions">
      <div class="message-counter" id="messageCounter" style="display:none;">
        <span id="messageCount">0</span> messages
      </div>
      <button class="new-thread-btn" onclick="clearChat()">
        <span>New Chat</span>
      </button>
    </div>
  </div>

  <div id="chat">
    <div class="empty-state" id="emptyState">
      <div class="empty-logo">⚡</div>
      <h1 class="empty-title">What can I help you explore?</h1>
      <p class="empty-subtitle">Ask me anything and I'll provide comprehensive, detailed answers with examples and explanations</p>
      
      <div class="suggestions-grid">
        <div class="suggestion-card" onclick="sendSuggestion('Explain quantum computing concepts, applications, and current limitations in detail')">
          <span class="suggestion-icon">🔬</span>
          <div class="suggestion-content">
            <div class="suggestion-title">Deep Dive: Quantum Computing</div>
            <div class="suggestion-desc">Comprehensive explanation of quantum mechanics principles, qubit operations, and real-world applications</div>
          </div>
        </div>
        
        <div class="suggestion-card" onclick="sendSuggestion('Create a complete Python web scraping tutorial with BeautifulSoup, error handling, and best practices')">
          <span class="suggestion-icon">🐍</span>
          <div class="suggestion-content">
            <div class="suggestion-title">Complete Python Tutorial</div>
            <div class="suggestion-desc">Step-by-step coding guide with examples, error handling, and production-ready practices</div>
          </div>
        </div>
        
        <div class="suggestion-card" onclick="sendSuggestion('Analyze current AI trends, breakthrough technologies, ethical considerations, and future predictions')">
          <span class="suggestion-icon">🤖</span>
          <div class="suggestion-content">
            <div class="suggestion-title">AI Industry Analysis</div>
            <div class="suggestion-desc">Comprehensive overview of AI developments, market trends, and societal implications</div>
          </div>
        </div>
        
        <div class="suggestion-card" onclick="sendSuggestion('Design a complete nutrition and meal planning system with recipes, shopping lists, and health tracking')">
          <span class="suggestion-icon">🥗</span>
          <div class="suggestion-content">
            <div class="suggestion-title">Complete Nutrition System</div>
            <div class="suggestion-desc">Holistic approach to meal planning, nutrition science, and sustainable healthy eating</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="typing-indicator" id="typingIndicator">
    <div class="msg-header">
      <div class="msg-avatar bot-avatar">⚡</div>
      <div class="msg-role">AI Assistant</div>
    </div>
    <div class="typing-content">
      <div class="typing-dots">
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      </div>
      <span>Analyzing and preparing comprehensive response...</span>
    </div>
  </div>

  <div class="input-wrapper">
    <div class="input-container">
      <div class="input-box">
        <textarea id="input" placeholder="Ask me anything for a detailed, comprehensive answer..." rows="1"></textarea>
        <div class="input-actions">
          <button id="send" title="Send message (Enter)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Enhanced JavaScript with better functionality -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>
// Enhanced chatbot functionality
class EnhancedChatbot {
  constructor() {
    this.chat = document.getElementById('chat');
    this.input = document.getElementById('input');
    this.sendBtn = document.getElementById('send');
    this.typingIndicator = document.getElementById('typingIndicator');
    this.emptyState = document.getElementById('emptyState');
    this.messageCounter = document.getElementById('messageCounter');
    this.messageCount = document.getElementById('messageCount');
    
    this.sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    this.messageTotal = 0;
    this.hasMessages = false;
    
    this.initializeEventListeners();
    this.configureMarked();
    this.input.focus();
  }
  
  initializeEventListeners() {
    // Auto-resize textarea
    this.input.addEventListener('input', () => {
      this.input.style.height = 'auto';
      this.input.style.height = Math.min(this.input.scrollHeight, 120) + 'px';
    });
    
    // Send message handlers
    this.sendBtn.addEventListener('click', () => this.sendMessage());
    this.input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        this.sendMessage();
      }
    });
    
    // Focus input when clicking anywhere on empty state
    this.emptyState.addEventListener('click', () => this.input.focus());
  }
  
  configureMarked() {
    // Configure marked for better rendering
    marked.setOptions({
      breaks: true,
      gfm: true,
      highlight: function(code, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(code, { language: lang }).value;
          } catch (err) {}
        }
        return hljs.highlightAuto(code).value;
      }
    });
  }
  
  clearChat() {
    this.chat.innerHTML = '';
    this.chat.appendChild(this.emptyState);
    this.emptyState.style.display = 'flex';
    this.hasMessages = false;
    this.messageTotal = 0;
    this.updateMessageCounter();
    this.input.value = '';
    this.input.style.height = 'auto';
    this.input.focus();
    
    // Clear session on server
    fetch('/api/clear-session', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ session_id: this.sessionId })
    }).catch(err => console.warn('Failed to clear server session:', err));
  }
  
  hideEmptyState() {
    if (!this.hasMessages) {
      this.emptyState.style.display = 'none';
      this.hasMessages = true;
      this.messageCounter.style.display = 'block';
    }
  }
  
  showTypingIndicator() {
    this.hideEmptyState();
    this.chat.appendChild(this.typingIndicator);
    this.typingIndicator.style.display = 'block';
    this.scrollToBottom();
  }
  
  hideTypingIndicator() {
    this.typingIndicator.style.display = 'none';
    if (this.typingIndicator.parentNode) {
      this.typingIndicator.parentNode.removeChild(this.typingIndicator);
    }
  }
  
  updateMessageCounter() {
    this.messageCount.textContent = this.messageTotal;
  }
  
  addMessage(role, text, timestamp = null) {
    this.hideEmptyState();
    this.hideTypingIndicator();
    
    const msgDiv = document.createElement('div');
    msgDiv.className = 'msg ' + role;
    
    const isUser = role === 'user';
    const displayTime = timestamp ? new Date(timestamp).toLocaleTimeString() : new Date().toLocaleTimeString();
    
    let content;
    if (isUser) {
      content = this.escapeHtml(text);
    } else {
      try {
        content = marked.parse(text);
        // Highlight code blocks after rendering
        setTimeout(() => {
          msgDiv.querySelectorAll('pre code').forEach(block => {
            hljs.highlightElement(block);
          });
        }, 0);
      } catch (err) {
        console.warn('Markdown parsing failed:', err);
        content = this.escapeHtml(text);
      }
    }
    
    msgDiv.innerHTML = `
      <div class="msg-header">
        <div class="msg-avatar ${isUser ? 'user-avatar' : 'bot-avatar'}">
          ${isUser ? 'You' : '⚡'}
        </div>
        <div class="msg-role">${isUser ? 'You' : 'AI Assistant'}</div>
        <div class="msg-timestamp">${displayTime}</div>
      </div>
      <div class="msg-content">${content}</div>
    `;
    
    this.chat.appendChild(msgDiv);
    this.messageTotal++;
    this.updateMessageCounter();
    this.scrollToBottom();
    
    return msgDiv;
  }
  
  scrollToBottom() {
    this.chat.scrollTop = this.chat.scrollHeight;
  }
  
  escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }
  
  showError(message) {
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-msg';
    errorDiv.innerHTML = `
      <span>⚠️</span>
      <span>${this.escapeHtml(message)}</span>
    `;
    
    this.hideTypingIndicator();
    const lastMsg = this.chat.lastElementChild;
    if (lastMsg && lastMsg !== this.emptyState) {
      lastMsg.appendChild(errorDiv);
    } else {
      this.addMessage('bot', `❌ **Error:** ${message}`);
    }
  }
  
  sendSuggestion(text) {
    this.input.value = text;
    this.sendMessage();
  }
  
  async sendMessage() {
    const text = this.input.value.trim();
    if (!text) return;
    
    // Disable send button and show loading state
    this.sendBtn.disabled = true;
    this.sendBtn.classList.add('sending');
    
    // Add user message
    this.addMessage('user', text);
    
    // Clear input
    this.input.value = '';
    this.input.style.height = 'auto';
    
    // Show typing indicator
    this.showTypingIndicator();
    
    try {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          message: text, 
          session_id: this.sessionId 
        })
      });
      
      if (!response.ok) {
        const errorData = await response.json().catch(() => ({}));
        throw new Error(errorData.detail || `HTTP ${response.status}: ${response.statusText}`);
      }
      
      const data = await response.json();
      
      // Add a small delay for better UX
      setTimeout(() => {
        this.addMessage('bot', data.reply, data.timestamp);
      }, 600);
      
    } catch (error) {
      console.error('Chat error:', error);
      setTimeout(() => {
        this.showError(error.message || 'Failed to get response. Please try again.');
      }, 600);
    } finally {
      // Re-enable send button after a delay
      setTimeout(() => {
        this.sendBtn.disabled = false;
        this.sendBtn.classList.remove('sending');
        this.input.focus();
      }, 1000);
    }
  }
}

// Initialize chatbot when page loads
let chatbot;
window.addEventListener('load', () => {
  chatbot = new EnhancedChatbot();
});

// Global functions for backward compatibility
function clearChat() {
  if (chatbot) chatbot.clearChat();
}

function sendSuggestion(text) {
  if (chatbot) chatbot.sendSuggestion(text);
}

// Service worker registration for potential PWA features
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    // Could register a service worker here for offline functionality
  });
}

// Add CSS for syntax highlighting
const highlightCSS = document.createElement('link');
highlightCSS.rel = 'stylesheet';
highlightCSS.href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css';
document.head.appendChild(highlightCSS);
</script>
</body>
</html>